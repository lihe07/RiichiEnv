# Development Guide

This document describes how to build and develop the Replay Visualizer (`tools/replay-visualizer`).

## Prerequisites

- Node.js (v18 or later recommended)
- `npm`

## Setup

1. **Install Dependencies**
   ```bash
   cd tools/replay-visualizer
   npm install
   ```

2. **Font Setup**
   The visualizer uses the **Zen Antique Soft** font for generating wind character icons. This font file is **not included in the repository** to respect licensing/distribution usage (or to keep the repo light).
   
   - Download the font from [Google Fonts: Zen Antique Soft](https://fonts.google.com/specimen/Zen+Antique+Soft).
   - Unzip the downloaded file.
   - Rename the font file (e.g., `ZenAntiqueSoft-Regular.ttf`) if necessary to match the expected filename, or verify the filename.
   - Place the `.ttf` file in the `tools/replay-visualizer/assets/` directory:
     ```
     tools/replay-visualizer/assets/ZenAntiqueSoft-Regular.ttf
     ```

## Asset Generation

Before building the viewer, you may need to generate the static assets (sprite sheet for wind characters) if you have modified them or if `src/char_assets.ts` is missing.

1. **Generate Character Sprite**
   This script uses the font file to generate a PNG sprite and embeds it into `src/char_assets.ts` as a Base64 string.
   ```bash
   node scripts/gen_sprite.js
   ```

## Build

To compile the TypeScript code and bundle the viewer:

```bash
npm run build
```

This command will:
1. Generate tile assets (`scripts/gen_tiles.js`).
2. Bundle and minify the code using `esbuild`.
3. Compress the output (`viewer.js.gz`) and copy it to the Python package directory.

> [!NOTE]
> The build requires `src/char_assets.ts`, which is generated by `scripts/gen_sprite.js`. If this file is missing, you must run the asset generation step first (see above).

## Development

To run a local development server with hot-reloading (basic watch mode):

```bash
npm run dev
```

Or to simply watch for changes and rebuild:

```bash
npm run watch
```
